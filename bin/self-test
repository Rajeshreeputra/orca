#!/usr/bin/env bash

# ORCA self test script.

set -e

cd "$(dirname "$0")/.."

composer install

echo && composer phpcs
echo && composer phpunit
echo && composer phpmd

# Copy an example project into place as a test SUT.
[[ -d "../example" ]] && rm -r ../example
cp -R tests/fixtures/projects/example ../

# Avoid testing locally with a stale cache.
./bin/orca cache:clear

# Execute tests from the SUT directory as a SUT would.
cd ../example

ORCA_PROJECTS_CONFIG="tests/fixtures/config/projects.yml" \
  ../orca/bin/travis/script drupal/example

echo && times
